{"version":3,"sources":["InputChoose.js"],"names":["InputChoose","React","Component","constructor","props","option","label","optionLabel","separator","i","length","isi","push","selectedOption","isReadonly","name","isMultiple","current_val","state","defaultValue","removed","new_val","optionValue","setInput","value","val","input","e","onRefresh","options","y","opt","cur","String","o","bind","setState","componentDidUpdate","prevProps","prevState","componentDidMount","render","disabled","justifyContent","flexDirection","padding","map","isChecked","paddingLeft","paddingRight","false","true","onChange","labelGenerate","substring","mapStateToProps","core","mapDispatchToProps","dispatch","key","type","payload"],"mappings":"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","sourcesContent":["import React from 'react';\r\n\r\nimport {\r\n  debounce,\r\n  isEmpty,\r\n  find,\r\n  isUndefined,\r\n  isNull,\r\n  isArray,\r\n  isEqual,\r\n  includes,\r\n} from 'lodash';\r\n\r\nimport { View, Text, Switch } from 'react-native';\r\n\r\nimport { findArrayName, slug } from 'tcomponent';\r\n\r\nimport InputFile from './InputFile';\r\n\r\nimport { connect } from 'react-redux';\r\n\r\n// import parse from 'html-react-parser';\r\n\r\nclass InputChoose extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.state = {\r\n      defaultValue: null,\r\n    };\r\n\r\n    // this.onRefresh = debounce(this.onRefresh.bind(this), 200);\r\n  }\r\n\r\n  onRefresh() {\r\n    let val = null;\r\n\r\n    let defaultValue = null;\r\n\r\n    if (this.props.value) {\r\n      val = this.props.value;\r\n    } else {\r\n      val = findArrayName(this.props.name, this.props.input) || null;\r\n    }\r\n\r\n    if (val) {\r\n      if (this.props.isMultiple) {\r\n        defaultValue = [];\r\n\r\n        for (let i = 0; i < this.props.options.length; i++) {\r\n          for (let y = 0; y < val.length; y++) {\r\n            let opt = this.props.options[i];\r\n\r\n            let cur = val[y];\r\n\r\n            if (String(opt[this.props.optionValue]) == String(cur)) {\r\n              defaultValue.push(opt[this.props.optionValue]);\r\n            }\r\n          }\r\n        }\r\n      } else {\r\n        defaultValue = find(\r\n          this.props.options,\r\n          function (o) {\r\n            return String(o[this.props.optionValue]) == String(val);\r\n          }.bind(this)\r\n        );\r\n      }\r\n    }\r\n\r\n    defaultValue =\r\n      !isUndefined(defaultValue) && !isNull(defaultValue) ? defaultValue : null;\r\n\r\n    this.setState({\r\n      defaultValue,\r\n    });\r\n  }\r\n\r\n  labelGenerate = (option) => {\r\n    let label = [];\r\n    if (isArray(this.props.optionLabel)) {\r\n      let separator = this.props.separator ? this.props.separator : ' | ';\r\n\r\n      for (let i = 0; i <= this.props.optionLabel.length - 1; i++) {\r\n        let isi = option[this.props.optionLabel[i]];\r\n\r\n        label.push(isi);\r\n      }\r\n    } else {\r\n      label.push(option[this.props.optionLabel]);\r\n    }\r\n\r\n    return label;\r\n  };\r\n\r\n  onChange = (selectedOption) => {\r\n    if (!this.props.isReadonly && this.props.name) {\r\n      try {\r\n        if (this.props.isMultiple) {\r\n          let current_val = this.state.defaultValue || [];\r\n\r\n          let removed = false;\r\n\r\n          let new_val = [];\r\n\r\n          for (let i = 0; i < current_val.length; i++) {\r\n            let isi = current_val[i];\r\n\r\n            if (isi == selectedOption[this.props.optionValue]) {\r\n              removed = true;\r\n            } else {\r\n              new_val.push(isi);\r\n            }\r\n          }\r\n\r\n          if (!removed) {\r\n            new_val.push(selectedOption[this.props.optionValue]);\r\n          }\r\n\r\n          this.props.setInput(this.props.name, new_val);\r\n        } else {\r\n          if (this.props.value) {\r\n            val = this.props.value;\r\n          } else {\r\n            val = findArrayName(this.props.name, this.props.input) || null;\r\n          }\r\n\r\n          if (val == selectedOption[this.props.optionValue]) {\r\n            this.props.setInput(this.props.name, null);\r\n          } else {\r\n            this.props.setInput(\r\n              this.props.name,\r\n              selectedOption[this.props.optionValue]\r\n            );\r\n          }\r\n        }\r\n      } catch (e) {\r\n        this.props.setInput(this.props.name, null);\r\n      }\r\n    }\r\n\r\n    this.onRefresh();\r\n  };\r\n\r\n  componentDidUpdate(prevProps, prevState) {\r\n    if (\r\n      !isEqual(\r\n        findArrayName(this.props.name, prevProps.input),\r\n        findArrayName(this.props.name, this.props.input)\r\n      ) &&\r\n      !isEqual(\r\n        this.state.defaultValue,\r\n        findArrayName(this.props.name, this.props.input)\r\n      )\r\n    ) {\r\n      this.onRefresh();\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.onRefresh();\r\n  }\r\n\r\n  render() {\r\n    let options = [];\r\n\r\n    try {\r\n      options = this.props.options.length > 0 ? this.props.options : [];\r\n    } catch (e) {}\r\n\r\n    const isReadonly = this.props.disabled || this.props.isReadonly;\r\n\r\n    return (\r\n      <View\r\n        style={{\r\n          justifyContent: 'space-between',\r\n          flexDirection: 'row',\r\n          padding: 10,\r\n        }}\r\n      >\r\n        {options.map((value) => {\r\n          let isChecked = false;\r\n\r\n          try {\r\n            if (this.props.isMultiple) {\r\n              isChecked = includes(\r\n                this.state.defaultValue,\r\n                value[this.props.optionValue]\r\n              );\r\n            } else {\r\n              isChecked = isEqual(\r\n                value[this.props.optionValue],\r\n                this.state.defaultValue[this.props.optionValue]\r\n              );\r\n            }\r\n          } catch (e) {}\r\n\r\n          return (\r\n            <View\r\n              style={{ paddingLeft: 8, paddingRight: 8 }}\r\n              key={value[this.props.optionValue]}\r\n            >\r\n              <Switch\r\n                disabled={isReadonly}\r\n                trackColor={{ false: '#767577', true: '#81b0ff' }}\r\n                thumbColor={isReadonly ? '#767577' : '#f4f3f4'}\r\n                ios_backgroundColor=\"#3e3e3e\"\r\n                onValueChange={this.onChange.bind(this, value)}\r\n                value={isChecked}\r\n              />\r\n              <View>\r\n                {this.labelGenerate(value).map((val, i) => {\r\n                  if (isEqual(String(val).substring(0, 3), 'AT-')) {\r\n                    return (\r\n                      <InputFile value={val} isReadonly={true} preview={true} />\r\n                    );\r\n                  } else {\r\n                    return <Text>{val}</Text>;\r\n                  }\r\n                })}\r\n              </View>\r\n            </View>\r\n          );\r\n        })}\r\n      </View>\r\n    );\r\n  }\r\n}\r\n\r\nlet mapStateToProps = (state) => ({\r\n  input: state.core.input || {},\r\n});\r\n\r\nlet mapDispatchToProps = (dispatch) => ({\r\n  setInput: (key, val) =>\r\n    dispatch({\r\n      type: 'SET_INPUT',\r\n      payload: {\r\n        key: slug(String(key)),\r\n        value: val,\r\n      },\r\n    }),\r\n});\r\n\r\nexport default connect(mapStateToProps, mapDispatchToProps)(InputChoose);\r\n"]}